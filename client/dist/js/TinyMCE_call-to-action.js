!function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var o={};e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s="./client/src/legacy/entwine/TinyMCE_call-to-action.js")}({"./client/src/legacy/entwine/TinyMCE_call-to-action.js":function(t,e,o){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=o(3),a=n(i),r=o(0),c=n(r),s=o(2),l=n(s),d=o(1),u=(n(d),{init:function(t){t.addButton("calltoaction",{text:a.default._t("CallToAction.ACTION_LABEL","[CtA]"),tooltip:a.default._t("CallToAction.ACTION_TOOLTIP","Insert Call to Action"),icon:!1,class:"mce_shortcode",cmd:"calltoaction"}),t.addCommand("calltoaction",function(){(0,c.default)("#"+t.id).entwine("ss").openCallToActionDialog(t)}),t.addContextToolbar(function(e){return t.dom.is(e,"div[data-cta-shortcode]")},"calltoaction"),this.beforeSetContent(t),this.onSetContent(t),this.onPreProcess(t)},handleRemoveCallToActionClick:function(t){},beforeSetContent:function(e){e.on("beforeSetContent",function(o){var n=(0,c.default)("#"+e.id).entwine("ss").getPlaceholderClasses(),i=o.content;n&&n.forEach(function(e){for(var o=null,n=0;(o=l.default.match(e,!0,i))&&n<100;)if(n+=1,o){var a=encodeURI("CallToActionController/shortcodePlaceHolder/"+e);t.ajax({url:a,type:"POST",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",async:!1,success:function(e){e=t(t(e)),e.attr("data-cta-shortcode",o.name),e.attr("data-cta-shortcode-wrapped",o.wrapped),e.attr("data-cta-shortcode-properties",JSON.stringify(o.properties)),e.attr("data-cta-shortcode-content",encodeURI(o.content)),i=i.replaceAll(o.original,e.prop("outerHTML"))}})}for(n=0;(o=l.default.match(e,!1,i))&&n<100;)if(n+=1,o){var r=encodeURI("CallToActionController/shortcodePlaceHolder/"+e);t.ajax({url:r,type:"POST",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",async:!1,success:function(e){e=t(t(e)),e.attr("data-cta-shortcode",o.name),e.attr("data-cta-shortcode-wrapped",o.wrapped),e.attr("data-cta-shortcode-properties",JSON.stringify(o.properties)),e.attr("data-cta-shortcode-content",encodeURI(o.content)),i=i.replaceAll(o.original,e.prop("outerHTML"))}})}}),o.content=i})},onPreProcess:function(e){e.on("PreProcess",function(e){t("[data-cta-shortcode]",e.node).each(function(e,o){var n=t(o);n.removeAttr("contentEditable");var i=n.data("cta-shortcode"),a=n.data("cta-shortcode-wrapped"),r=n.data("cta-shortcode-properties"),c=decodeURI(n.data("cta-shortcode-content")),s=l.default.serialise({name:i,properties:r,content:c,wrapped:a},!1);n.replaceWith(s)})})},onSetContent:function(t){t.on("SetContent",function(e){var o=t.$("[data-cta-shortcode]");t.undoManager.transact(function(){o.each(function(t,e){e.contentEditable=!1})})})}});c.default.entwine("ss",function(t){t("select.shortcode-type").entwine({onchange:function(){this.parents("form:first").reloadForm("type",this.val())}}),t(".htmleditorfield-dialog").entwine({Bookmark:null,onadd:function(){this.is(".ui-dialog-content")||this.ssdialog({autoOpen:!0}),this._super()},getForm:function(){return this.find("form")},open:function(t){this.ssdialog("open")},close:function(){this.ssdialog("close")},toggle:function(t){this.is(":visible")?this.close():this.open()}}),t("textarea.htmleditor").entwine({getPlaceholderClasses:function(){var e=t(this).data("placeholderclasses");if(e)return e.split(",")},getCtaDataObjectClassName:function(){return t(this).data("cta-dataobjectclassname")},getCtaDataObjectID:function(){return t(this).data("cta-dataobjectid")},openCallToActionDialog:function(e){var o=this,n=t(".htmleditorfield-calltoaction-dialog"),i=e.selection.getBookmark(2,!0);n.length?(n.getForm().setElement(this),n.setBookmark(i),n.open(e)):(n=t('<div class="htmleditorfield-dialog htmleditorfield-calltoaction-dialog loading">'),t("body").append(n),t.ajax({url:"CallToActionController/CallToActionForm/forTemplate",complete:function(){n.removeClass("loading")},success:function(t){n.html(t),n.getForm().setElement(o),n.setBookmark(i),n.open(e),n.trigger("ssdialogopen")}}))}}),t("form.htmleditorfield-cta").entwine({Selection:null,Bookmark:null,Element:null,setSelection:function(e){return this._super(t(e))},onremove:function(){this.setSelection(null),this.setBookmark(null),this.setElement(null),this._super()},reloadForm:function(e,o){var n={},i=this.getEditor();return"type"==e?n.CallToActionType=o:"shortcode"==e&&(n.Shortcode=o),n.DataObjectClassName=(0,c.default)("#"+i.getInstance().id).entwine("ss").getCtaDataObjectClassName(),n.DataObjectID=(0,c.default)("#"+i.getInstance().id).entwine("ss").getCtaDataObjectID(),this.addClass("loading"),t.post("CallToActionController/CallToActionForm/forTemplate",n,function(e){var o=t("form.htmleditorfield-cta");o.find("fieldset").replaceWith(t(e).find("fieldset")).show(),o.removeClass("loading")}),this},onsubmit:function(t){return this.insertShortcode(),this.getDialog().close(),!1},insertShortcode:function(){var t=this.getHTML();t.length&&this.modifySelection(function(e){e.getInstance().undoManager.transact(function(){tinyMCE.activeEditor.plugins.calltoaction,e.replaceContent(t)})})},modifySelection:function(t){var e=this.getEditor();e.moveToBookmark(this.getBookmark()),t.call(this,e),this.setSelection(e.getSelectedNode()),this.setBookmark(e.createBookmark()),e.blur()},getEditor:function(){return this.getElement().getEditor()},getDialog:function(){return this.closest(".htmleditorfield-dialog")},getHTML:function(){var t=this.getAttributes(),e=null;t.attributes.content&&(e=t.attributes.content);var o=null!==e,n=[];for(var i in t.attributes)"content"!=i&&(n[i]=t.attributes[i]);return l.default.serialise({name:t.shortcodeType,properties:n,content:e,wrapped:o},!1)},getAttributes:function(){var e={},o=this.find(":input[name=id]").val();o&&(e.id=o);var n=(JSON.stringify(this.serializeArray()),this.find(".attributes-composite"));return n.length&&n.find(":input").each(function(){var o=t(this),n=o.val(),i=o.prop("name");if(o.is(".checkbox")&&!o.is(":checked"))return!0;if(""!==n)if(i.indexOf("[")>-1){var a=i.substring(0,i.indexOf("["));void 0!==e[a]?e[a]+=","+n:e[a]=n}else o.is(".checkbox")?e[o.prop("name")]=o.is(":checked")?1:0:e[o.prop("name")]=n}),{shortcodeType:this.find(":input[name=CallToActionType]").val().replaceAll(/\\/g,"_"),attributes:e}},resetFields:function(){this._super(),this.find(":input[name=CallToActionType]").val(""),this.find(".attributes-composite").hide(),this.find("#id.field").hide()},updateFromEditor:function(){var t=this.getCurrentShortcode().trim();this.reloadForm("shortcode",t)},getCurrentShortcode:function(){var e=t(this.getSelection()),o=e.text();if(void 0!==e.data("cta-shortcode")){var n=e,i=n.data("cta-shortcode"),a=n.data("cta-shortcode-wrapped"),r=n.data("cta-shortcode-properties"),c=decodeURI(n.data("cta-shortcode-content"));return l.default.serialise({name:i,properties:r,content:c,wrapped:a},!1)}return o},fromDialog:{onssdialogopen:function(){var t=this.getEditor().getInstance();this.setBookmark(this.parent().getBookmark()),t.selection.moveToBookmark(this.parent().getBookmark()),this.setSelection(t.selection.getNode()),this.find(':input:not(:submit)[data-skip-autofocus!="true"]').filter(":visible:enabled").eq(0).focus(),this.redraw(),this.updateFromEditor()},onssdialogclose:function(){var t=this.getEditor();t.onclose(),t.moveToBookmark(this.getBookmark()),this.setSelection(null),this.setBookmark(null),this.resetFields()}}})}),tinymce.PluginManager.add("calltoaction",function(t){return u.init(t)}),e.default=u}).call(e,o(0))},0:function(t,e){t.exports=jQuery},1:function(t,e){t.exports=React},2:function(t,e){t.exports=ShortcodeSerialiser},3:function(t,e){t.exports=i18n}});